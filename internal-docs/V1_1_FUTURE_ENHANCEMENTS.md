# Kumiki 拡張機能開発状況

このドキュメントは、MVP完成後の機能拡張に関する開発状況とタスクリストです。

## ✅ 1. トランジション機能 (完了済み) 

**実装完了日: 2025-07-20**

### 1.1 トランジション基盤 ✅
- [x] TransitionService の実装 ✅
- [x] シーン間の中間フレーム生成 ✅ 
- [x] トランジション用の一時ファイル管理 ✅

### 1.2 各トランジションタイプの実装 ✅
- [x] **fade** - フェードトランジション ✅
  - [x] クロスフェード処理 ✅
  - [x] 持続時間の設定 ✅
  - [x] 音声のクロスフェード対応 ✅
- [x] **wipe** - ワイプトランジション ✅
  - [x] 方向指定（上下左右すべて対応） ✅
  - [x] FFmpeg xfadeフィルター使用 ✅
  - [x] left, right, up, down 方向対応 ✅
- [x] **dissolve** - ディゾルブトランジション ✅
  - [x] FFmpeg dissolveフィルター使用 ✅
  - [x] 持続時間の設定 ✅

### 1.3 トランジション統合 ✅
- [x] Rendererへのトランジション処理組み込み ✅
- [x] シーン結合時の自動適用 ✅
- [x] 逆順処理による正確なトランジション適用 ✅
- [x] 音声なし動画への対応 ✅
- [x] 動画時長の自動検出とオフセット計算 ✅

### 1.4 実装された機能詳細
- **TransitionService**: シングルトンパターンでトランジション処理を管理
- **FFmpegService拡張**: transition専用メソッド（fade/wipe/dissolve）追加
- **音声対応**: 音声ストリーム検出と適切なフィルター選択
- **エラーハンドリング**: 音声なし動画への適切な対応
- **テスト済み**: すべてのシーンタイプ（text/image/video）間でのトランジション

### 1.5 作成されたExample
- `transition-test.json`: 全トランジションタイプと方向のテスト

## 2. 音声処理の拡張 (中優先度)

### 2.1 高度な音声機能
- [ ] **複数音声トラック**のサポート
  - [ ] 音声ミキシング
  - [ ] トラック別音量調整
- [ ] **フェードイン/アウト**
  - [ ] BGMの自動フェード
  - [ ] シーン切り替え時の音声処理
- [ ] **音声エフェクト**
  - [ ] エコー、リバーブ等の基本エフェクト
  - [ ] 音声フィルターの適用

### 2.2 音声同期
- [ ] シーンタイミングとの同期
- [ ] 音声遅延の調整

## 3. 新しいシーンタイプ (中優先度)

### 3.1 複合シーンタイプ
- [ ] **composite** - 複数要素の組み合わせシーン
  - [ ] テキスト＋画像の重ね合わせ
  - [ ] レイヤー管理
  - [ ] Z-index対応

## 4. CLI改善 (低優先度)

### 4.1 使いやすさの向上
- [ ] インタラクティブモード
- [ ] プロジェクトテンプレート
- [ ] 設定ウィザード

### 4.2 追加コマンド
- [ ] `kumiki init` - プロジェクト初期化
- [ ] `kumiki template` - テンプレート管理
- [ ] `kumiki config` - 設定管理

## 5. ドキュメント (継続的)

### 5.1 ユーザードキュメント
- [ ] APIリファレンス（TypeDoc）
- [ ] ユーザーガイド（日本語/英語）
- [ ] サンプルプロジェクト集
- [ ] ビデオチュートリアル

### 5.2 サンプルとテンプレート
- [ ] 基本的なテキスト動画サンプル
- [ ] 画像スライドショーサンプル
- [ ] 複雑なアニメーションサンプル
- [ ] 業界別テンプレート（プレゼン、広告、教育等）

## 実装優先順位

1. **フェーズ1** ✅ **完了済み** (2025-07-20)
   - ✅ トランジション機能の実装

2. **フェーズ2** (次期開発予定)
   - 音声処理の拡張
   - 複合シーンタイプ

3. **フェーズ3** (継続的)
   - CLI改善
   - ドキュメント整備
   - サンプル作成

## v1.1 開発完了サマリー

### 実装済み機能
- ✅ **完全なトランジションシステム**: fade、wipe（4方向）、dissolve
- ✅ **クロスプラットフォーム対応**: 音声ありなし両方の動画に対応
- ✅ **全シーンタイプ対応**: text、image、video間のシームレストランジション
- ✅ **高品質レンダリング**: FFmpeg xfadeフィルターによる品質保証
- ✅ **包括的テスト**: 複数のexampleファイルによる動作検証

### 技術的成果
- TypeSpec スキーマへのTransitionモデル統合
- TransitionService の設計と実装
- FFmpegService の拡張（音声検出、時長検出）
- Renderer への逆順トランジション処理統合
- 完全なエラーハンドリングと堅牢性

### 次回開発推奨事項
1. **音声処理の拡張**: BGMフェードイン/アウト、複数音声トラック
2. **複合シーンタイプ**: テキスト+画像オーバーレイ
3. **パフォーマンス最適化**: 大容量ファイル処理の改善

## 技術的考慮事項

### 依存関係
- トランジション: FFmpegのトランジションフィルター機能
- 音声処理: FFmpegの音声フィルター活用

### 互換性
- 既存APIとの後方互換性維持
- 段階的な機能追加によるスムーズな移行
- TypeSpecスキーマの適切な拡張

### 実装方針
- 各機能は独立したモジュールとして実装
- 既存コードへの影響を最小限に抑制
- 設定はオプショナルとし、デフォルト動作を保証